Функция ДоговорЭквайринга(Организация)
	Запрос = Новый Запрос ;
	Запрос.УстановитьПараметр("Организация",Организация);
	Запрос.текст = 
	"ВЫБРАТЬ ПЕРВЫЕ 1
	|	ДоговорыЭквайринга.Ссылка КАК ДоговорЭквайринга,
	|	ДоговорыЭквайринга.ДоговорВзаиморасчетов КАК ДоговорВзаиморасчетовЭквайрера,
	|	ДоговорыЭквайринга.Эквайрер
	|ИЗ
	|	Справочник.ДоговорыЭквайринга КАК ДоговорыЭквайринга
	|ГДЕ
	|	ДоговорыЭквайринга.ДоговорВзаиморасчетов.Организация = &Организация"   ;
	Выборка = Запрос.Выполнить().Выбрать() ;
	
	Если  Выборка.Следующий() Тогда ;
		Возврат Выборка ;
	КонецЕсли ;
	
КонецФункции

Процедура ПересчитатьТорговуюУступку(ДоговорЭквайринга,ОплатыПлатежнымиКартами)
	
	Если Не ДоговорЭквайринга.Пустая() Тогда 
		
		Тарифы = ДоговорЭквайринга.ТарифыЗаРасчетноеОбслуживание.Выгрузить();
		
		Для каждого стрОплата из ОплатыПлатежнымиКартами Цикл 
			ПроцентТорговойУступки = 0 ;
			
			стрТариф = Тарифы.Найти(стрОплата.ВидОплаты,"ВидОплаты") ;
			Если стрТариф <> Неопределено Тогда
				ПроцентТорговойУступки = стрТариф.ПроцентТорговойУступки ;						
				стрОплата.ПроцентТорговойУступки = ПроцентТорговойУступки ;
				стрОплата.СуммаТорговойУступки = стрОплата.Сумма*ПроцентТорговойУступки/100 ;
			КонецЕсли ;	
		КонецЦикла ;
		
	КонецЕсли ;	
КонецПроцедуры 
